<?xml version="1.0"?>
<ruleset name="LaterPay">
    <description>A custom set of rules to check for a LaterPay WordPress plugin</description>
    <rule ref="Generic.WhiteSpace.DisallowTabIndent"/>
    <rule ref="Generic.WhiteSpace.ScopeIndent">
        <properties>
            <property name="indent" value="4"/>
            <property name="ignoreIndentationTokens" type="array" value="T_COMMENT,T_DOC_COMMENT"/>
            <property name="tabIndent" value="false"/>
        </properties>
    </rule>

    <rule ref="WordPress">
        <exclude name="Generic.WhiteSpace.DisallowSpaceIndent" />
        <exclude name="WordPress.PHP.YodaConditions" />
        <!-- WP VIP rules which are very restrictive and not all that applicable -->
        <exclude name="WordPress.VIP.DirectDatabaseQuery" />
        <exclude name="WordPress.VIP.FileSystemWritesDisallow"/>
        <exclude name="WordPress.VIP.RestrictedFunctions.user_meta" />
        <exclude name="WordPress.VIP.RestrictedFunctions.switch_to_blog"/>
        <exclude name="WordPress.VIP.RestrictedFunctions.wp_remote_get"/>
        <exclude name="WordPress.VIP.RestrictedFunctions.file_get_contents"/>
        <exclude name="WordPress.VIP.RestrictedFunctions.curl"/>
        <exclude name="WordPress.VIP.RestrictedFunctions.get_term_link"/>
        <exclude name="WordPress.VIP.RestrictedFunctions.get_term_by"/>
        <exclude name="WordPress.VIP.RestrictedFunctions.get_page_by_title"/>
        <exclude name="WordPress.VIP.RestrictedVariables.cache_constraints"/>
        <exclude name="WordPress.VIP.RestrictedVariables.user_meta"/>
        <exclude name="WordPress.VIP.PostsPerPage.posts_per_page"/>
    </rule>
    <rule ref="WordPress.XSS.EscapeOutput">
        <properties>
            <property name="customSanitizingFunctions" value="laterpay_sanitize_output" type="array"/>
            <property name="customAutoEscapedFunctions" value="laterpay_sanitized" type="array"/>
        </properties>
    </rule>
    <rule ref="WordPress.Variables.GlobalVariables">
        <severity>0</severity>
    </rule>

	<!-- Exclude ALL THE THINGS until we pass, then let's iteratively remove exclusions and fix things chunk by chunk -->
	<rule ref="WordPress">
		<!-- Exclusions we should drop ASAP, just here to get a passing test run -->
		<exclude name="PSR2.Files.ClosingTag.NotAllowed"/>
		<exclude name="PSR2.Methods.MethodDeclaration.FinalAfterVisibility"/>
		<exclude name="WordPress.CSRF.NonceVerification.NoNonceVerification"/>
		<exclude name="WordPress.Functions.DontExtract.extract_extract"/>
		<exclude name="WordPress.VIP.PostsPerPage.posts_per_page_posts_per_page"/>
		<exclude name="WordPress.VIP.RestrictedFunctions.get_page_by_title_get_page_by_title"/>
		<exclude name="WordPress.VIP.RestrictedFunctions.user_meta_get_user_meta"/>
		<exclude name="WordPress.VIP.RestrictedFunctions.user_meta_update_user_meta"/>
		<exclude name="WordPress.VIP.RestrictedVariables.user_meta__wpdb__usermeta"/>
		<exclude name="WordPress.VIP.ValidatedSanitizedInput"/>
		<exclude name="WordPress.WP.DeprecatedFunctions.like_escapeFound"/>
		<exclude name="WordPress.WP.I18n.NonSingularStringLiteralText"/>
		<exclude name="WordPress.WP.PreparedSQL.NotPrepared"/>
		<exclude name="WordPress.XSS.EscapeOutput.OutputNotEscaped"/>
		<!-- Relatively cosmetic exclusions - important to fix, but less urgent than the above -->
		<exclude name="Generic.Classes.OpeningBraceSameLine"/>
		<exclude name="Generic.Files.EndFileNewline.NotFound"/>
		<exclude name="Generic.Functions.OpeningFunctionBraceKernighanRitchie"/>
		<exclude name="PSR2.ControlStructures.SwitchDeclaration"/>
		<exclude name="Squiz"/>
		<exclude name="WordPress.Arrays"/>
		<exclude name="WordPress.Files.FileName"/>
		<exclude name="WordPress.Functions.FunctionCallSignatureNoParams.WhitespaceFound"/>
		<exclude name="WordPress.NamingConventions"/>
		<exclude name="WordPress.WP.I18n.MissingTranslatorsComment"/>
		<exclude name="WordPress.WP.I18n.UnorderedPlaceholdersText"/>
		<exclude name="WordPress.WhiteSpace"/>
	</rule>
</ruleset>
